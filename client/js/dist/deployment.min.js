"use strict";var spectateState={};spectateState.Players={},spectateState.boundaries=[],spectateState.holes=[],spectateState.text={},spectateState.height=0,spectateState.hearts={},spectateState.init=function(){Client.socketConnect(),spectateState.state.disableVisibilityChange=!1,setSpectateEventHandlers()},spectateState.create=function(){game.state.backgroundColor="#333",game.world.setBounds(0,0,1900,1900),spectateState.Player=game.add.group(),spectateState.bound=game.add.group(),spectateState.pulse=setInterval(spectateState.heartBeat,16),Client.askNewSpectator(),spectateState.cursors=game.input.keyboard.createCursorKeys(),game.add.text(winW/2,50,"use the arrow keys to pan the camera",{font:"35px Arial",fill:"#ffbfda"}).anchor.set(.5)},spectateState.update=function(){spectateState.holes.length||spectateState.rawHoles&&spectateState.renderHoles(spectateState.rawHoles),spectateState.cursors.up.isDown?game.camera.y-=16:spectateState.cursors.down.isDown&&(game.camera.y+=16),spectateState.cursors.left.isDown?game.camera.x-=16:spectateState.cursors.right.isDown&&(game.camera.x+=16)},spectateState.updatePlayerPosition=function(a){var b=spectateState.Players[a.id],c=spectateState.text[a.username],d=spectateState.hearts[a.id];if(b){var e=spectateState.add.tween(b);e.to({x:a.x,y:a.y},16),e.start();var f=spectateState.add.tween(c);if(f.to({x:a.x,y:a.y},16),f.start(),a.lives!==d.length){d.pop().destroy()}for(var g=-20,h=0;h<a.lives;h++){var i=spectateState.add.tween(d[h]);i.to({x:a.x+g,y:a.y+10},16),i.start(),g+=20}}},spectateState.addNewPlayer=function(a){spectateState.displayPlayerInfo(a);var b=a.id;spectateState.Players[a.id]&&spectateState.Players[a.id].destroy(),spectateState.Players[a.id]=spectateState.Player.create(a.x,a.y,""+a.colorID);var a=spectateState.Players[a.id];a.anchor.x=.5,a.anchor.y=.5,console.log(b,loadState.username),console.log(a),b===loadState.username&&(game.physics.enable(a),game.camera.follow(a))},spectateState.remove=function(a){spectateState.Players[a].destroy(),delete spectateState.Players[a]},spectateState.death=function(a){(spectateState.text[a.id].destroy(),spectateState.hearts[a.id][0].destroy(),a.id===loadState.username)&&(console.log("you lost"),game.add.text(a.x,a.y,"spectateState Over",{font:"50px Arial",fill:"#fff"}));a=spectateState.Players[a.id],a.kill()},spectateState.displayPlayerInfo=function(a){if(a.username){var b=a.username,c=spectateState.hearts[a.id];c&&c.forEach(function(a){return a.destroy()}),spectateState.text[b]&&spectateState.text[b].destroy(),spectateState.text[b]=game.add.text(a.x,a.y,b,{font:"18px Arial",fill:"#fff"});var d=spectateState.text[b];d.setShadow(3,3,"rgba(0,0,0,0.5)",5),d.anchor.x=.5,d.anchor.y=.5,spectateState.hearts[a.id]=[];for(var e=-20,f=0;f<a.lives;f++){var g=game.add.sprite(a.x+e,a.y+10,"heart");g.anchor.x=.5,spectateState.hearts[a.id].push(g),e+=20}}},spectateState.renderHoles=function(a){spectateState.hole=game.add.group(),a.forEach(function(a){spectateState.holes.push(spectateState.hole.create(a.x,a.y,"hole"))}),spectateState.holes.forEach(function(a){a.anchor.x=.5,a.animations.add("explode",[9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36]),a.anchor.y=.5,a.animations.play("explode",20,!0)})},spectateState.over=function(a){game.state.start("Results",!0,!1,a),Client.disconnect(),spectateState.Players={},spectateState.boundaries=[],spectateState.holes=[],spectateState.text={}};var Game={};Game.Players={},Game.boundaries=[],Game.holes=[],Game.text={},Game.height=0,Game.hearts={},Game.init=function(){game.state.disableVisibilityChange=!1,setGameEventHandlers(),game.physics.startSystem(Phaser.Physics.Arcade)},Game.create=function(){game.state.backgroundColor="#333",game.world.setBounds(0,0,1900,1900),Client.askNewPlayer(),Game.cursor={x:450,y:300},Game.Player=game.add.group(),Game.bound=game.add.group(),Game.heartBeat(),Game.pulse=setInterval(Game.heartBeat,16)},Game.update=function(){Game.holes.length||Game.rawHoles&&Game.renderHoles(Game.rawHoles),Game.cursor={x:game.input.activePointer.worldX,y:game.input.activePointer.worldY},game.input.activePointer.isDown&&(Game.cursor={x:game.input.activePointer.worldX,y:game.input.activePointer.worldY})},Game.heartBeat=function(){Client.heartBeat(Game.cursor)},Game.updatePlayerPosition=function(a){var b=Game.Players[a.id],c=Game.text[a.username],d=Game.hearts[a.id];if(b){var e=Game.add.tween(b);e.to({x:a.x,y:a.y},16),e.start();var f=Game.add.tween(c);if(f.to({x:a.x,y:a.y},16),f.start(),a.lives!==d.length){d.pop().destroy()}for(var g=-20,h=0;h<a.lives;h++){var i=Game.add.tween(d[h]);i.to({x:a.x+g,y:a.y+10},16),i.start(),g+=20}}},Game.addNewPlayer=function(a){Game.displayPlayerInfo(a);var b=a.id;Game.Players[a.id]&&Game.Players[a.id].destroy(),Game.Players[a.id]=Game.Player.create(a.x,a.y,""+a.colorID);var a=Game.Players[a.id];a.anchor.x=.5,a.anchor.y=.5,console.log(b,loadState.username),console.log(a),b===loadState.username&&(game.physics.enable(a),game.camera.follow(a))},Game.remove=function(a){Game.Players[a].destroy(),delete Game.Players[a]},Game.death=function(a){(Game.text[a.id].destroy(),Game.hearts[a.id][0].destroy(),a.id===loadState.username)&&(console.log("you lost"),game.add.text(a.x,a.y,"Game Over",{font:"50px Arial",fill:"#fff"}));a=Game.Players[a.id],a.kill()},Game.displayPlayerInfo=function(a){if(a.username){var b=a.username,c=Game.hearts[a.id];c&&c.forEach(function(a){return a.destroy()}),Game.text[b]&&Game.text[b].destroy(),Game.text[b]=game.add.text(a.x,a.y,b,{font:"18px Arial",fill:"#fff"});var d=Game.text[b];d.setShadow(3,3,"rgba(0,0,0,0.5)",5),d.anchor.x=.5,d.anchor.y=.5,Game.hearts[a.id]=[];for(var e=-20,f=0;f<a.lives;f++){var g=game.add.sprite(a.x+e,a.y+10,"heart");g.anchor.x=.5,Game.hearts[a.id].push(g),e+=20}}},Game.renderHoles=function(a){Game.hole=game.add.group(),a.forEach(function(a){Game.holes.push(Game.hole.create(a.x,a.y,"hole"))}),Game.holes.forEach(function(a){a.animations.add("explode",[9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36]),a.anchor.y=.5,a.anchor.x=.5,a.animations.play("explode",20,!0)})},Game.over=function(a){game.state.start("Results",!0,!1,a),Client.disconnect(),Game.Players={},Game.boundaries=[],Game.holes=[],Game.text={}};var gameResult={init:function(a){lobbyState.isReady=!1,console.log("params",a),game.world.setBounds(0,0,winW-50,winH-50);var b=_.filter(a,function(a){return a.lives>0}),c=_.filter(a,function(a){return 0===a.lives}),d=b[0];console.log("winners",b[0]),console.log("losers",c),game.add.text(game.world.width/2,40,"Winner: Player "+d.id+" ",{font:"50px Arial",fill:"#f001f2"}).anchor.set(.5),this.drawLosers(c),game.add.text(game.world.width/2,game.world.height-40,"click to return to the lobby",{font:"25px Arial",fill:"#f001f2"}).anchor.set(.5)},update:function(){game.input.activePointer.isDown&&game.state.start("Load")},drawLosers:function(a){var b=80;_.forEach(a,function(a){var c={font:"bold 30pt italic",fill:"#ffbfda"},d=game.add.text(80,b,"Loser",c);game.add.text(d.x+d.width+30,b,a.id,c);b+=75})},toLobby:function(){game.state.start("Lobby")}},loadState={preload:function(){game.add.text(80,150,"loading...",{font:"40px Courier",fill:"#ffffff"});game.load.image("0","https://ddu0j6ouvozck.cloudfront.net/0.png"),game.load.image("1","https://ddu0j6ouvozck.cloudfront.net/1.png"),game.load.image("2","https://ddu0j6ouvozck.cloudfront.net/2.png"),game.load.image("3","https://ddu0j6ouvozck.cloudfront.net/3.png"),game.load.image("4","https://ddu0j6ouvozck.cloudfront.net/4.png"),game.load.image("5","https://ddu0j6ouvozck.cloudfront.net/5.png"),game.load.image("6","https://ddu0j6ouvozck.cloudfront.net/6.png"),game.load.image("7","https://ddu0j6ouvozck.cloudfront.net/7.png"),game.load.image("8","https://ddu0j6ouvozck.cloudfront.net/8.png"),game.load.image("9","https://ddu0j6ouvozck.cloudfront.net/9.png"),game.load.image("10","https://ddu0j6ouvozck.cloudfront.net/10.png"),game.load.image("11","https://ddu0j6ouvozck.cloudfront.net/11.png"),game.load.image("vertical","https://ddu0j6ouvozck.cloudfront.net/rectanglevertical.png"),game.load.image("horiontal","https://ddu0j6ouvozck.cloudfront.net/rectangle.png"),game.load.image("joinAsPlayerButton","https://ddu0j6ouvozck.cloudfront.net/playButton.jpg"),game.load.image("joinAsSpectatorButton","https://ddu0j6ouvozck.cloudfront.net/spectateButton.png"),game.load.spritesheet("hole","https://ddu0j6ouvozck.cloudfront.net/explosionSprite.png",300,300,81),game.load.spritesheet("playerNotReady","https://ddu0j6ouvozck.cloudfront.net/playerNotReady.png",138,138,4),game.load.image("playerReady","https://ddu0j6ouvozck.cloudfront.net/playerReady.png"),game.load.image("heart","https://ddu0j6ouvozck.cloudfront.net/heartSprite.png")},create:function(){Client.socketConnect(),setLobbyEventHandlers(),console.log(window.spectate),window.spectate&&(console.log("spectate"),game.state.start("Spectate")),loadState.username=localStorage["reduxPersist:user"]?JSON.parse(localStorage["reduxPersist:user"]).displayName||window.username:window.username,loadState.colorID=localStorage["reduxPersist:user"]?JSON.parse(localStorage["reduxPersist:user"]).avatar||Math.floor(11*Math.random()):Math.floor(11*Math.random()),loadState.username||Client.needUsername()},update:function(){loadState.username&&(console.log("game is starting"),game.state.start("Lobby"))}},lobbyState={playerNameHeight:30,isReady:!1,preload:function(){},create:function(){Client.joinLobby(),game.state.backgroundColor="#333",game.input.keyboard.addKey(Phaser.Keyboard.R).onDown.addOnce(this.ready,this)},update:function(){game.input.activePointer.isDown&&this.ready()},ready:function(){this.isReady||Client.ready(),this.isReady=!0},addStartLabels:function(){game.add.text(game.world.width/2,50,"Welcome to Game Server 1",{font:"35px Arial",fill:"#ffbfda"}).anchor.set(.5),game.add.text(game.world.width/2,game.world.height-50,"click when you are ready",{font:"35px Arial",fill:"#ffbfda"}).anchor.set(.5)},renderServerInfo:function(a){this.allReady(a)&&a.length>1&&(removeAllSocketListeners(),game.state.start("Game")),game.world.children=[],this.addStartLabels();var b=80;_.forEach(a,function(a){var c={font:"bold 30pt italic",fill:"#f001f2"},d=game.add.text(80,b,a.id,c);if(a.ready){game.add.button(d.x+d.width,b,"playerReady")}else{var e=game.add.sprite(d.x+d.width,b,"playerNotReady");e.scale.set(.5),e.animations.add("toggle",[0,1,2,3],12,!0),e.play("toggle")}b+=75})},allReady:function(a){return a.reduce(function(a,b){return a&&b.ready},!0)}},winW=window.innerWidth,winH=window.innerHeight,game=new Phaser.Game(winW-50,winH-50,Phaser.CANVAS,document.getElementById("game"),null,!1);game.state.add("Load",loadState),game.state.add("Menu",menuState),game.state.add("Lobby",lobbyState),game.state.add("Game",Game),game.state.add("Spectate",spectateState),game.state.add("Results",gameResult),game.state.start("Load");var menuState={create:function(){Client.socketConnect();game.add.text(80,80,"Pearl Jam",{font:"50px Arial",fill:"#000000"}),game.add.button(0,200,"joinAsPlayerButton",menuState.joinAsPlayer,this,2,1,0),game.add.button(200,150,"joinAsSpectatorButton",menuState.joinAsSpectator,this,2,1,0)},joinAsPlayer:function(){game.state.start("Lobby")},joinAsSpectator:function(){game.state.start("Spectate")}};